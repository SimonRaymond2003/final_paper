---
title: "starter_vs_onfield"
output: pdf_document
date: "2025-04-02"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
library(data.table)
library(dplyr)
library(knitr)
library(kableExtra)
library(tools)

# Options for better output
options(max.print=10000)
options(knitr.kable.NA = '')
```

```{r transform_function}
# Column Name Transformer for Football Analytics with individual OL positions
transform_column_names <- function(df) {
  # Position mapping with individual OL positions
  offense_positions <- c(
    # QB slots (1-3)
    "1" = "QB", "2" = "QB2", "3" = "QB3",
    # Backs slots (4-7)
    "4" = "RB", "5" = "RB2", "6" = "FB", "7" = "FB2",
    # Wide receivers slots (8-13)
    "8" = "WR1", "9" = "WR2", "10" = "WR3", "11" = "WR4", "12" = "WR5", "13" = "WR6",
    # Tight ends slots (14-16)
    "14" = "TE1", "15" = "TE2", "16" = "TE3",
    # Offensive line slots (17-24) - now with unique identifiers
    "17" = "OL1", "18" = "OL2", "19" = "OL3", "20" = "OL4", "21" = "OL5", 
    "22" = "OL6", "23" = "OL7", "24" = "OL8"
  )
  
  defense_positions <- c(
    # Defensive line slots (1-8)
    "1" = "DL1", "2" = "DL2", "3" = "DL3", "4" = "DL4", 
    "5" = "DL5", "6" = "DL6", "7" = "DL7", "8" = "DL8",
    # Linebackers slots (9-14)
    "9" = "LB1", "10" = "LB2", "11" = "LB3", "12" = "LB4", 
    "13" = "LB5", "14" = "LB6",
    # Cornerbacks slots (15-19)
    "15" = "CB1", "16" = "CB2", "17" = "CB3", "18" = "CB4", "19" = "CB5",
    # Safeties slots (20-23)
    "20" = "S1", "21" = "S2", "22" = "S3", "23" = "S4"
  )
  
  # Get column names
  cols <- colnames(df)
  new_cols <- cols
  
  for (i in seq_along(cols)) {
    col <- cols[i]
    
    # Handle offense player patterns
    if (grepl("offense_player_", col)) {
      player_num <- gsub(".*offense_player_([0-9\\-]+).*", "\\1", col)
      
      # Determine position
      if (grepl("-", player_num)) {
        # Handle OL range notation if present (e.g., "17-21")
        # Extract the range and assign appropriate OL position
        range_parts <- strsplit(player_num, "-")[[1]]
        if (length(range_parts) == 2) {
          start_num <- as.numeric(range_parts[1])
          if (start_num >= 17 && start_num <= 24) {
            position <- paste0("OL", start_num - 16)  # Convert slot to OL position number
          } else {
            position <- paste0("OFF", player_num)
          }
        } else {
          position <- paste0("OFF", player_num)
        }
      } else if (player_num %in% names(offense_positions)) {
        position <- offense_positions[player_num]
      } else {
        position <- paste0("OFF", player_num)
      }
      
      # Replace pattern and remove first two words after
      if (grepl("^starter_", col)) {
        parts <- strsplit(gsub("starter_offense_player_[0-9\\-]+_", "", col), "_")[[1]]
        if (length(parts) >= 2) {
          parts <- parts[-(1:2)]
        }
        new_cols[i] <- paste("starter", position, paste(parts, collapse = "_"), sep = "_")
      } else {
        parts <- strsplit(gsub("offense_player_[0-9\\-]+_", "", col), "_")[[1]]
        if (length(parts) >= 2) {
          parts <- parts[-(1:2)]
        }
        new_cols[i] <- paste(position, paste(parts, collapse = "_"), sep = "_")
      }
    }
    
    # Handle defense player patterns
    else if (grepl("defense_player_", col)) {
      player_num <- gsub(".*defense_player_([0-9]+).*", "\\1", col)
      
      # Determine position
      if (player_num %in% names(defense_positions)) {
        position <- defense_positions[player_num]
      } else {
        position <- paste0("DEF", player_num)
      }
      
      # Replace pattern and remove first two words after
      if (grepl("^starter_", col)) {
        parts <- strsplit(gsub("starter_defense_player_[0-9]+_", "", col), "_")[[1]]
        if (length(parts) >= 2) {
          parts <- parts[-(1:2)]
        }
        new_cols[i] <- paste("starter", position, paste(parts, collapse = "_"), sep = "_")
      } else {
        parts <- strsplit(gsub("defense_player_[0-9]+_", "", col), "_")[[1]]
        if (length(parts) >= 2) {
          parts <- parts[-(1:2)]
        }
        new_cols[i] <- paste(position, paste(parts, collapse = "_"), sep = "_")
      }
    }
  }
  
  # Set the new column names
  colnames(df) <- new_cols
  return(df)
}
```

```{r load_data}
# Manually load only the 4 datasets specifically for grades (offensive and defensive)

# 1. Load offensive grades outcome data
off_grades_outcome <- fread("unstandardized_processed_predict_ccafd_off_grades.csv.csv.gz")
# Apply transformation to column names
off_grades_outcome <- transform_column_names(off_grades_outcome)
```


